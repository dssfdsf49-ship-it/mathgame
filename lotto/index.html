<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¡œë˜ 6/45 ì‹œë®¬ë ˆì´í„°</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#8aa0c7; --text:#e9f0ff;
      --line:rgba(255,255,255,.10); --accent:#7aa7ff; --good:#35d07f; --bad:#ff5f73;
      --chip:#1a2540;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#081022,#0b1220 40%,#0a1020);
      color:var(--text);
    }
    header{
      padding:18px 18px 10px; border-bottom:1px solid var(--line);
      position:sticky; top:0; backdrop-filter:blur(10px);
      background:rgba(11,18,32,.72);
      z-index:5;
    }
    h1{margin:0; font-size:18px; letter-spacing:.2px}
    .sub{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.4}
    main{max-width:1100px; margin:0 auto; padding:16px}
    .tabs{display:flex; gap:8px; margin:10px 0 14px; flex-wrap:wrap}
    .tab{
      border:1px solid var(--line); background:transparent; color:var(--text);
      padding:8px 12px; border-radius:999px; cursor:pointer; font-size:13px;
      opacity:.85;
    }
    .tab.active{background:rgba(122,167,255,.16); border-color:rgba(122,167,255,.45); opacity:1}
    .grid{
      display:grid; grid-template-columns: 1.05fr .95fr; gap:14px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .card{
      background:rgba(18,26,43,.86); border:1px solid var(--line);
      border-radius:18px; padding:14px;
      box-shadow:0 14px 40px rgba(0,0,0,.28);
    }
    .card h2{margin:0 0 10px; font-size:14px; color:#dbe7ff}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, select{
      width:100%; padding:10px 10px; border-radius:12px;
      border:1px solid var(--line); background:#0c1325; color:var(--text);
      outline:none;
    }
    input:focus,select:focus{border-color:rgba(122,167,255,.55)}
    .field{flex:1; min-width:160px}
    .btn{
      border:1px solid var(--line); background:rgba(255,255,255,.06);
      color:var(--text); padding:10px 12px; border-radius:12px;
      cursor:pointer; font-size:13px;
    }
    .btn:hover{border-color:rgba(122,167,255,.45)}
    .btn.primary{
      background:linear-gradient(90deg,rgba(122,167,255,.25),rgba(122,167,255,.12));
      border-color:rgba(122,167,255,.55);
    }
    .btn.danger{
      background:linear-gradient(90deg,rgba(255,95,115,.22),rgba(255,95,115,.10));
      border-color:rgba(255,95,115,.55);
    }
    .muted{color:var(--muted); font-size:12px; line-height:1.45}
    .numbers{
      display:grid; grid-template-columns: repeat(9, 1fr); gap:8px;
      margin-top:10px;
    }
    @media (max-width: 520px){ .numbers{grid-template-columns: repeat(6, 1fr);} }
    .ball{
      user-select:none;
      border:1px solid var(--line); background:var(--chip);
      border-radius:999px; text-align:center; padding:10px 0;
      cursor:pointer; font-weight:700; font-size:12px;
      transition:transform .06s ease, border-color .15s ease, background .15s ease;
    }
    .ball:active{transform:scale(.98)}
    .ball.sel{
      background:rgba(122,167,255,.22);
      border-color:rgba(122,167,255,.70);
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(255,255,255,.05);
      font-size:12px; color:var(--text);
    }
    .pill b{letter-spacing:.2px}
    .kvs{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    @media (max-width: 520px){ .kvs{grid-template-columns: 1fr;} }
    .kv{
      border:1px solid var(--line); background:rgba(255,255,255,.04);
      border-radius:14px; padding:10px;
    }
    .kv .k{font-size:12px; color:var(--muted)}
    .kv .v{margin-top:6px; font-size:16px; font-weight:800}
    .good{color:var(--good)} .bad{color:var(--bad)}
    .list{
      border:1px solid var(--line); border-radius:14px; overflow:hidden; margin-top:10px
    }
    .list .head, .list .item{
      display:grid; grid-template-columns: 72px 1fr 90px 90px;
      gap:10px; padding:10px 10px; align-items:center;
    }
    .list .head{
      background:rgba(255,255,255,.05); color:var(--muted); font-size:12px;
    }
    .list .item{border-top:1px solid var(--line); font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .barwrap{
      margin-top:10px; height:12px; border-radius:999px;
      border:1px solid var(--line); background:rgba(255,255,255,.04); overflow:hidden
    }
    .bar{height:100%; width:0%; background:linear-gradient(90deg, rgba(122,167,255,.65), rgba(53,208,127,.65))}
    .note{
      margin-top:10px; border-left:3px solid rgba(122,167,255,.55);
      padding:10px 10px; background:rgba(122,167,255,.08); border-radius:12px;
      font-size:12px; color:#dbe7ff
    }
    .hide{display:none}
    .right{justify-content:flex-end}
    .spacer{flex:1}
    .mini{font-size:11px; color:var(--muted)}
  </style>
</head>
<body>
<header>
  <h1>ë¡œë˜ 6/45 ì‹œë®¬ë ˆì´í„°</h1>
  <div class="sub">
    êµìœ¡/ì¬ë¯¸ìš© ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤. ì‹¤ì œ ë¡œë˜ëŠ” íšŒì°¨ë³„ ì´íŒë§¤/ë‹¹ì²¨ììˆ˜ì— ë”°ë¼ 1~3ë“± ìƒê¸ˆì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì´ ì•±ì€ <b>ì…ë ¥í•œ ìƒê¸ˆí‘œ</b>ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.
  </div>
  <div class="tabs" role="tablist" aria-label="ëª¨ë“œ ì„ íƒ">
    <button class="tab active" data-tab="single" role="tab" aria-selected="true">í‹°ì¼“ ìƒì„± Â· 1íšŒ ì¶”ì²¨</button>
    <button class="tab" data-tab="mc" role="tab" aria-selected="false">ì‹œë®¬ë ˆì´ì…˜(ëª¬í…Œì¹´ë¥¼ë¡œ)</button>
  </div>
</header>

<main>
  <!-- SINGLE MODE -->
  <section id="tab-single">
    <div class="grid">
      <div class="card">
        <h2>â‘  ë²ˆí˜¸ ì„ íƒ(ì„ íƒì‚¬í•­) Â· ìë™/ìˆ˜ë™</h2>
        <div class="muted">ì•„ë˜ì—ì„œ 6ê°œë¥¼ ê³ ë¥´ë©´ â€œê³ ì • ë²ˆí˜¸â€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ í‹°ì¼“ì€ ìë™ìœ¼ë¡œ ëœë¤ ìƒì„±ë©ë‹ˆë‹¤.</div>

        <div class="numbers" id="picker"></div>

        <div class="row" style="margin-top:12px">
          <span class="pill">ì„ íƒ: <b id="selCount">0</b>/6</span>
          <span class="pill">ë‚´ ë²ˆí˜¸: <b class="mono" id="selNums">-</b></span>
          <span class="spacer"></span>
          <button class="btn" id="btnQuickPick">ë¹ ë¥¸ì„ íƒ(6ê°œ)</button>
          <button class="btn" id="btnClearPick">ì„ íƒ ì´ˆê¸°í™”</button>
        </div>

        <div class="note">
          âœ… â€œê³ ì • ë²ˆí˜¸ë¡œ í‹°ì¼“ ë§Œë“¤ê¸°â€ë¥¼ ëˆ„ë¥´ë©´, ê°™ì€ ë²ˆí˜¸ë¡œ ì—¬ëŸ¬ ì¥ì„ ìƒì„±í•©ë‹ˆë‹¤.<br/>
          âœ… â€œëœë¤ í‹°ì¼“ ë§Œë“¤ê¸°â€ëŠ” ë§¤ ì¥ë§ˆë‹¤ ë‹¤ë¥¸ ë²ˆí˜¸ë¥¼ ë½‘ìŠµë‹ˆë‹¤.
        </div>
      </div>

      <div class="card">
        <h2>â‘¡ í‹°ì¼“ ìƒì„± Â· ìƒê¸ˆí‘œ</h2>
        <div class="row">
          <div class="field">
            <label>í‹°ì¼“ ì¥ìˆ˜</label>
            <input id="ticketCount" type="number" min="1" max="5000" value="10" />
            <div class="mini">ê¶Œì¥: 1~5000 (ë¸Œë¼ìš°ì € ì„±ëŠ¥ì— ë”°ë¼)</div>
          </div>
          <div class="field">
            <label>1ì¥ ê°€ê²©(ì›)</label>
            <input id="ticketPrice" type="number" min="0" step="100" value="1000" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="field">
            <label>1ë“±(6ê°œ ì¼ì¹˜) ìƒê¸ˆ(ì›)</label>
            <input id="p1" type="number" min="0" step="1000000" value="2000000000" />
          </div>
          <div class="field">
            <label>2ë“±(5+ë³´ë„ˆìŠ¤) ìƒê¸ˆ(ì›)</label>
            <input id="p2" type="number" min="0" step="100000" value="50000000" />
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <div class="field">
            <label>3ë“±(5ê°œ) ìƒê¸ˆ(ì›)</label>
            <input id="p3" type="number" min="0" step="10000" value="1500000" />
          </div>
          <div class="field">
            <label>4ë“±(4ê°œ) ìƒê¸ˆ(ì›)</label>
            <input id="p4" type="number" min="0" step="1000" value="50000" />
          </div>
          <div class="field">
            <label>5ë“±(3ê°œ) ìƒê¸ˆ(ì›)</label>
            <input id="p5" type="number" min="0" step="1000" value="5000" />
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn primary" id="btnMakeFixed">ê³ ì • ë²ˆí˜¸ë¡œ í‹°ì¼“ ë§Œë“¤ê¸°</button>
          <button class="btn" id="btnMakeRandom">ëœë¤ í‹°ì¼“ ë§Œë“¤ê¸°</button>
          <span class="spacer"></span>
          <button class="btn danger" id="btnResetTickets">í‹°ì¼“ ë¹„ìš°ê¸°</button>
        </div>

        <div class="list" id="ticketList">
          <div class="head">
            <div>#</div><div>í‹°ì¼“ ë²ˆí˜¸</div><div class="right">ì¼ì¹˜</div><div class="right">ë“±ìˆ˜</div>
          </div>
          <div class="item">
            <div class="muted">-</div>
            <div class="muted">ì•„ì§ í‹°ì¼“ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            <div class="right muted">-</div>
            <div class="right muted">-</div>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn primary" id="btnDraw">ì¶”ì²¨í•˜ê¸°(1íšŒ)</button>
          <button class="btn" id="btnRedraw">ë‹¤ì‹œ ì¶”ì²¨(ë²ˆí˜¸ë§Œ)</button>
        </div>

        <div class="note" id="drawNote">
          ì¶”ì²¨ ë²ˆí˜¸ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:14px">
      <div class="card">
        <h2>â‘¢ ê²°ê³¼ ìš”ì•½</h2>
        <div class="kvs">
          <div class="kv"><div class="k">êµ¬ë§¤ê¸ˆì•¡</div><div class="v mono" id="sumCost">0</div></div>
          <div class="kv"><div class="k">ë‹¹ì²¨ê¸ˆ í•©ê³„</div><div class="v mono" id="sumWin">0</div></div>
          <div class="kv"><div class="k">ìˆœì†ìµ</div><div class="v mono" id="sumNet">0</div></div>
          <div class="kv"><div class="k">ROI(ìˆ˜ìµë¥ )</div><div class="v mono" id="sumRoi">0%</div></div>
        </div>

        <div class="list" style="margin-top:12px">
          <div class="head">
            <div>ë“±ìˆ˜</div><div>ì¡°ê±´</div><div class="right">ê°œìˆ˜</div><div class="right">ìƒê¸ˆ</div>
          </div>
          <div class="item"><div>1</div><div class="muted">6ê°œ ì¼ì¹˜</div><div class="right mono" id="c1">0</div><div class="right mono" id="w1">0</div></div>
          <div class="item"><div>2</div><div class="muted">5ê°œ + ë³´ë„ˆìŠ¤</div><div class="right mono" id="c2">0</div><div class="right mono" id="w2">0</div></div>
          <div class="item"><div>3</div><div class="muted">5ê°œ ì¼ì¹˜</div><div class="right mono" id="c3">0</div><div class="right mono" id="w3">0</div></div>
          <div class="item"><div>4</div><div class="muted">4ê°œ ì¼ì¹˜</div><div class="right mono" id="c4">0</div><div class="right mono" id="w4">0</div></div>
          <div class="item"><div>5</div><div class="muted">3ê°œ ì¼ì¹˜</div><div class="right mono" id="c5">0</div><div class="right mono" id="w5">0</div></div>
          <div class="item"><div>ê½</div><div class="muted">ê·¸ ì™¸</div><div class="right mono" id="c0">0</div><div class="right mono">0</div></div>
        </div>
      </div>

      <div class="card">
        <h2>â‘£ ë©”ëª¨</h2>
        <div class="muted">
          - â€œì¶”ì²¨í•˜ê¸°(1íšŒ)â€ëŠ” í‹°ì¼“ì„ í‰ê°€í•˜ê³  ìš”ì•½ê¹Œì§€ ê°±ì‹ í•©ë‹ˆë‹¤.<br/>
          - â€œë‹¤ì‹œ ì¶”ì²¨(ë²ˆí˜¸ë§Œ)â€ì€ ë‹¹ì²¨ë²ˆí˜¸ë§Œ ë°”ê¾¸ê³ , ê¸°ì¡´ í‹°ì¼“ìœ¼ë¡œ ë‹¤ì‹œ í‰ê°€í•©ë‹ˆë‹¤.<br/>
          - ìˆ«ì ìƒì„±ì€ ë¸Œë¼ìš°ì € ë‚œìˆ˜(ì•”í˜¸í•™ì  ê°•ë„ X) ê¸°ë°˜ì…ë‹ˆë‹¤.<br/>
          - ì„±ëŠ¥: í‹°ì¼“ì„ ìˆ˜ì²œ ì¥ ì´ìƒ ë§Œë“¤ë©´ í‘œì‹œê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆì–´ìš”.
        </div>
      </div>
    </div>
  </section>

  <!-- MONTE CARLO -->
  <section id="tab-mc" class="hide">
    <div class="grid">
      <div class="card">
        <h2>â‘  ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</h2>
        <div class="row">
          <div class="field">
            <label>ë°˜ë³µ íšŸìˆ˜(Trials)</label>
            <input id="mcTrials" type="number" min="1" max="200000" value="20000" />
            <div class="mini">ê¶Œì¥: 5ì²œ~5ë§Œ (PC ì„±ëŠ¥ì— ë”°ë¼)</div>
          </div>
          <div class="field">
            <label>ë§¤ ë°˜ë³µë§ˆë‹¤ êµ¬ë§¤í•  í‹°ì¼“ ì¥ìˆ˜</label>
            <input id="mcTickets" type="number" min="1" max="2000" value="10" />
          </div>
          <div class="field">
            <label>ì‹œë“œ(ì¬í˜„ ê°€ëŠ¥, ì„ íƒ)</label>
            <input id="mcSeed" type="text" placeholder="ì˜ˆ: 20251216 (ë¹„ìš°ë©´ ëœë¤)" />
            <div class="mini">ê°™ì€ ì‹œë“œë©´ ê°™ì€ ê²°ê³¼(ë™ì¼ ì¡°ê±´) ì¬í˜„</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="field">
            <label>êµ¬ë§¤ ë°©ì‹</label>
            <select id="mcMode">
              <option value="randomEach">ë§¤ ì¥ ëœë¤(ì¼ë°˜ ìë™)</option>
              <option value="fixedSame">ê³ ì • ë²ˆí˜¸ 1ê°œ ì„¸íŠ¸ë¡œ ë°˜ë³µ êµ¬ë§¤(ìˆ˜ë™/ê³ ì •)</option>
            </select>
          </div>
          <div class="field">
            <label>ê³ ì • ë²ˆí˜¸(6ê°œ, mc ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©)</label>
            <input id="mcFixed" type="text" placeholder="ì˜ˆ: 1, 7, 12, 21, 33, 45" />
          </div>
        </div>

        <div class="note">
          ğŸ’¡ â€œTrials Ã— í‹°ì¼“ ì¥ìˆ˜â€ ë§Œí¼ íŒì •í•©ë‹ˆë‹¤. ì˜ˆ) 20,000 Ã— 10 = 200,000ì¥ í‰ê°€
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="btnMcStart">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>
          <button class="btn danger" id="btnMcStop" disabled>ì¤‘ì§€</button>
          <span class="spacer"></span>
          <span class="pill">ì§„í–‰: <b id="mcProg">0%</b></span>
        </div>

        <div class="barwrap"><div class="bar" id="mcBar"></div></div>
      </div>

      <div class="card">
        <h2>â‘¡ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h2>
        <div class="kvs">
          <div class="kv"><div class="k">ì´ í‰ê°€ í‹°ì¼“</div><div class="v mono" id="mcTotalTickets">0</div></div>
          <div class="kv"><div class="k">ê¸°ëŒ€ ë‹¹ì²¨ê¸ˆ(í‹°ì¼“ 1ì¥ë‹¹)</div><div class="v mono" id="mcEvPerTicket">0</div></div>
          <div class="kv"><div class="k">ê¸°ëŒ€ ì†ìµ(í‹°ì¼“ 1ì¥ë‹¹)</div><div class="v mono" id="mcNetPerTicket">0</div></div>
          <div class="kv"><div class="k">ê¸°ëŒ€ ROI</div><div class="v mono" id="mcRoi">0%</div></div>
        </div>

        <div class="list" style="margin-top:12px">
          <div class="head">
            <div>ë“±ìˆ˜</div><div>ì¡°ê±´</div><div class="right">í™•ë¥ (ì¶”ì •)</div><div class="right">íšŸìˆ˜</div>
          </div>
          <div class="item"><div>1</div><div class="muted">6ê°œ ì¼ì¹˜</div><div class="right mono" id="mp1">0</div><div class="right mono" id="mn1">0</div></div>
          <div class="item"><div>2</div><div class="muted">5ê°œ + ë³´ë„ˆìŠ¤</div><div class="right mono" id="mp2">0</div><div class="right mono" id="mn2">0</div></div>
          <div class="item"><div>3</div><div class="muted">5ê°œ ì¼ì¹˜</div><div class="right mono" id="mp3">0</div><div class="right mono" id="mn3">0</div></div>
          <div class="item"><div>4</div><div class="muted">4ê°œ ì¼ì¹˜</div><div class="right mono" id="mp4">0</div><div class="right mono" id="mn4">0</div></div>
          <div class="item"><div>5</div><div class="muted">3ê°œ ì¼ì¹˜</div><div class="right mono" id="mp5">0</div><div class="right mono" id="mn5">0</div></div>
          <div class="item"><div>ê½</div><div class="muted">ê·¸ ì™¸</div><div class="right mono" id="mp0">0</div><div class="right mono" id="mn0">0</div></div>
        </div>

        <div class="note">
          ğŸ“Œ ìƒê¸ˆí‘œ(1~5ë“±)ì™€ í‹°ì¼“ ê°€ê²©ì€ â€œí‹°ì¼“ ìƒì„± Â· ìƒê¸ˆí‘œâ€ì˜ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </section>
</main>

<script>
/* ---------------------------
   Utilities
---------------------------- */
const fmt = (n) => {
  const x = Number.isFinite(n) ? Math.trunc(n) : 0;
  return x.toLocaleString("ko-KR");
};
const pct = (x) => (Number.isFinite(x) ? (x*100).toFixed(4) : "0.0000") + "%";

function uniqSorted(arr){
  const s = Array.from(new Set(arr)).sort((a,b)=>a-b);
  return s;
}
function parseNums(text){
  const parts = text.split(/[^0-9]+/).filter(Boolean).map(v=>parseInt(v,10));
  return parts.filter(v=>Number.isFinite(v) && v>=1 && v<=45);
}

/* Seedable RNG (LCG + xorshift-ish mix) for MC reproducibility */
function makeRng(seedStr){
  if(!seedStr) return { next: () => Math.random() };
  // hash seed string -> 32-bit
  let h = 2166136261 >>> 0;
  for (let i=0;i<seedStr.length;i++){
    h ^= seedStr.charCodeAt(i);
    h = Math.imul(h, 16777619) >>> 0;
  }
  let state = (h || 1) >>> 0;
  return {
    next: () => {
      // xorshift32
      state ^= (state << 13) >>> 0;
      state ^= (state >>> 17) >>> 0;
      state ^= (state << 5) >>> 0;
      return (state >>> 0) / 4294967296;
    }
  };
}

function drawTicket(rng){
  const nums = [];
  while(nums.length < 6){
    const v = 1 + Math.floor(rng.next() * 45);
    if(!nums.includes(v)) nums.push(v);
  }
  nums.sort((a,b)=>a-b);
  return nums;
}

function drawWinning(rng){
  const seven = [];
  while(seven.length < 7){
    const v = 1 + Math.floor(rng.next() * 45);
    if(!seven.includes(v)) seven.push(v);
  }
  seven.sort((a,b)=>a-b);
  const main = seven.slice(0,6);
  const bonus = seven[6];
  // ensure bonus not in main (it isn't, due to uniqueness)
  return { main, bonus };
}

function gradeTicket(ticket, win){
  let match = 0;
  const winSet = new Set(win.main);
  for (const n of ticket) if (winSet.has(n)) match++;
  const hasBonus = ticket.includes(win.bonus);

  if (match === 6) return { rank: 1, match, bonus: false };
  if (match === 5 && hasBonus) return { rank: 2, match, bonus: true };
  if (match === 5) return { rank: 3, match, bonus: false };
  if (match === 4) return { rank: 4, match, bonus: false };
  if (match === 3) return { rank: 5, match, bonus: false };
  return { rank: 0, match, bonus: false };
}

function getPrizeTable(){
  return {
    price: Number(document.querySelector("#ticketPrice").value) || 0,
    p1: Number(document.querySelector("#p1").value) || 0,
    p2: Number(document.querySelector("#p2").value) || 0,
    p3: Number(document.querySelector("#p3").value) || 0,
    p4: Number(document.querySelector("#p4").value) || 0,
    p5: Number(document.querySelector("#p5").value) || 0,
  };
}
function prizeOf(rank, t){
  if(rank===1) return t.p1;
  if(rank===2) return t.p2;
  if(rank===3) return t.p3;
  if(rank===4) return t.p4;
  if(rank===5) return t.p5;
  return 0;
}

/* ---------------------------
   Tabs
---------------------------- */
const tabs = document.querySelectorAll(".tab");
tabs.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    tabs.forEach(x=>x.classList.remove("active"));
    btn.classList.add("active");
    const tab = btn.dataset.tab;
    document.querySelector("#tab-single").classList.toggle("hide", tab !== "single");
    document.querySelector("#tab-mc").classList.toggle("hide", tab !== "mc");
    tabs.forEach(x=>x.setAttribute("aria-selected", String(x===btn)));
  });
});

/* ---------------------------
   Picker UI
---------------------------- */
const pickerEl = document.querySelector("#picker");
let picked = [];
for(let i=1;i<=45;i++){
  const b = document.createElement("div");
  b.className = "ball";
  b.textContent = i;
  b.dataset.n = String(i);
  b.addEventListener("click", ()=>{
    const n = Number(b.dataset.n);
    const idx = picked.indexOf(n);
    if(idx >= 0){
      picked.splice(idx,1);
    } else {
      if(picked.length >= 6) return;
      picked.push(n);
    }
    picked = picked.sort((a,b)=>a-b);
    renderPicked();
  });
  pickerEl.appendChild(b);
}
function renderPicked(){
  document.querySelector("#selCount").textContent = String(picked.length);
  document.querySelector("#selNums").textContent = picked.length ? picked.join(", ") : "-";
  document.querySelectorAll(".ball").forEach(el=>{
    const n = Number(el.dataset.n);
    el.classList.toggle("sel", picked.includes(n));
  });
}
document.querySelector("#btnClearPick").addEventListener("click", ()=>{
  picked = [];
  renderPicked();
});
document.querySelector("#btnQuickPick").addEventListener("click", ()=>{
  const rng = makeRng(""); // random
  picked = drawTicket(rng);
  renderPicked();
});
renderPicked();

/* ---------------------------
   Tickets & Single draw
---------------------------- */
let tickets = []; // array of { nums: number[], result?: {rank, match, bonus}, prize?: number }
let lastWin = null;

const listEl = document.querySelector("#ticketList");

function renderTickets(){
  listEl.innerHTML = `
    <div class="head">
      <div>#</div><div>í‹°ì¼“ ë²ˆí˜¸</div><div class="right">ì¼ì¹˜</div><div class="right">ë“±ìˆ˜</div>
    </div>
  `;
  if(tickets.length === 0){
    const row = document.createElement("div");
    row.className="item";
    row.innerHTML = `
      <div class="muted">-</div>
      <div class="muted">ì•„ì§ í‹°ì¼“ì´ ì—†ìŠµë‹ˆë‹¤.</div>
      <div class="right muted">-</div>
      <div class="right muted">-</div>
    `;
    listEl.appendChild(row);
    updateSummary();
    return;
  }

  // limit render for performance
  const maxShow = 300;
  const show = tickets.slice(0, maxShow);
  show.forEach((t, idx)=>{
    const r = t.result;
    const row = document.createElement("div");
    row.className="item";
    row.innerHTML = `
      <div class="muted">${idx+1}</div>
      <div class="mono">${t.nums.join(", ")}</div>
      <div class="right mono">${r ? r.match + (r.rank===2 ? "+B" : "") : "-"}</div>
      <div class="right mono">${r ? (r.rank===0 ? "ê½" : r.rank+"ë“±") : "-"}</div>
    `;
    listEl.appendChild(row);
  });

  if(tickets.length > maxShow){
    const more = document.createElement("div");
    more.className="item";
    more.innerHTML = `<div class="muted">â€¦</div><div class="muted">í‘œì‹œëŠ” ${maxShow}ì¥ê¹Œì§€ë§Œ(ì´ ${fmt(tickets.length)}ì¥)</div><div></div><div></div>`;
    listEl.appendChild(more);
  }

  updateSummary();
}

function setDrawNote(){
  const box = document.querySelector("#drawNote");
  if(!lastWin){
    box.textContent = "ì¶”ì²¨ ë²ˆí˜¸ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }
  box.innerHTML = `
    <b>ë‹¹ì²¨ ë²ˆí˜¸</b>: <span class="mono">${lastWin.main.join(", ")}</span>
    &nbsp; | &nbsp;
    <b>ë³´ë„ˆìŠ¤</b>: <span class="mono">${lastWin.bonus}</span>
  `;
}

function evaluateAll(){
  if(!lastWin) return;
  const table = getPrizeTable();

  const counts = {0:0,1:0,2:0,3:0,4:0,5:0};
  const wins = {1:0,2:0,3:0,4:0,5:0};

  for(const t of tickets){
    const r = gradeTicket(t.nums, lastWin);
    t.result = r;
    const money = prizeOf(r.rank, table);
    t.prize = money;
    counts[r.rank] = (counts[r.rank]||0) + 1;
    if(r.rank>=1 && r.rank<=5) wins[r.rank] += money;
  }

  // update rank table
  document.querySelector("#c1").textContent = fmt(counts[1]||0);
  document.querySelector("#c2").textContent = fmt(counts[2]||0);
  document.querySelector("#c3").textContent = fmt(counts[3]||0);
  document.querySelector("#c4").textContent = fmt(counts[4]||0);
  document.querySelector("#c5").textContent = fmt(counts[5]||0);
  document.querySelector("#c0").textContent = fmt(counts[0]||0);

  document.querySelector("#w1").textContent = fmt(wins[1]||0);
  document.querySelector("#w2").textContent = fmt(wins[2]||0);
  document.querySelector("#w3").textContent = fmt(wins[3]||0);
  document.querySelector("#w4").textContent = fmt(wins[4]||0);
  document.querySelector("#w5").textContent = fmt(wins[5]||0);

  renderTickets();
}

function updateSummary(){
  const table = getPrizeTable();
  const cost = (table.price * tickets.length) || 0;
  const win = tickets.reduce((s,t)=>s + (t.prize||0), 0);
  const net = win - cost;
  const roi = cost>0 ? (win / cost - 1) : 0;

  document.querySelector("#sumCost").textContent = fmt(cost);
  document.querySelector("#sumWin").textContent  = fmt(win);
  document.querySelector("#sumNet").textContent  = (net>=0?"+":"") + fmt(net);
  document.querySelector("#sumNet").className    = "v mono " + (net>=0 ? "good":"bad");
  document.querySelector("#sumRoi").textContent  = (cost>0 ? (roi*100).toFixed(2) : "0.00") + "%";
  document.querySelector("#sumRoi").className    = "v mono " + (roi>=0 ? "good":"bad");
}

document.querySelector("#btnResetTickets").addEventListener("click", ()=>{
  tickets = [];
  renderTickets();
  // reset per-rank table too
  ["c1","c2","c3","c4","c5","c0","w1","w2","w3","w4","w5"].forEach(id=>{
    document.querySelector("#"+id).textContent = "0";
  });
});

document.querySelector("#btnMakeFixed").addEventListener("click", ()=>{
  const n = Number(document.querySelector("#ticketCount").value) || 1;
  if(picked.length !== 6){
    alert("ê³ ì • ë²ˆí˜¸ëŠ” 6ê°œë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.");
    return;
  }
  for(let i=0;i<n;i++){
    tickets.push({ nums: [...picked] });
  }
  if(lastWin) evaluateAll(); else renderTickets();
});

document.querySelector("#btnMakeRandom").addEventListener("click", ()=>{
  const n = Number(document.querySelector("#ticketCount").value) || 1;
  const rng = makeRng(""); // random
  for(let i=0;i<n;i++){
    tickets.push({ nums: drawTicket(rng) });
  }
  if(lastWin) evaluateAll(); else renderTickets();
});

document.querySelector("#btnDraw").addEventListener("click", ()=>{
  if(tickets.length === 0){
    alert("ë¨¼ì € í‹°ì¼“ì„ ìƒì„±í•˜ì„¸ìš”.");
    return;
  }
  const rng = makeRng(""); // random draw
  lastWin = drawWinning(rng);
  setDrawNote();
  evaluateAll();
});

document.querySelector("#btnRedraw").addEventListener("click", ()=>{
  if(tickets.length === 0){
    alert("ë¨¼ì € í‹°ì¼“ì„ ìƒì„±í•˜ì„¸ìš”.");
    return;
  }
  const rng = makeRng(""); // random draw
  lastWin = drawWinning(rng);
  setDrawNote();
  evaluateAll();
});

/* ---------------------------
   Monte Carlo Simulation
---------------------------- */
let mcStopFlag = false;

function setMcUiRunning(running){
  document.querySelector("#btnMcStart").disabled = running;
  document.querySelector("#btnMcStop").disabled = !running;
}

document.querySelector("#btnMcStop").addEventListener("click", ()=>{
  mcStopFlag = true;
});

document.querySelector("#btnMcStart").addEventListener("click", async ()=>{
  const trials = Math.max(1, Math.min(200000, Number(document.querySelector("#mcTrials").value)||1));
  const perTrialTickets = Math.max(1, Math.min(2000, Number(document.querySelector("#mcTickets").value)||1));
  const mode = document.querySelector("#mcMode").value;
  const seedStr = document.querySelector("#mcSeed").value.trim();
  const rng = makeRng(seedStr || null);

  let fixedNums = null;
  if(mode === "fixedSame"){
    const parsed = uniqSorted(parseNums(document.querySelector("#mcFixed").value));
    if(parsed.length !== 6){
      alert("ê³ ì • ë²ˆí˜¸ ëª¨ë“œì—ì„œëŠ” ê³ ì • ë²ˆí˜¸ 6ê°œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. (1~45, ì¤‘ë³µ ë¶ˆê°€)");
      return;
    }
    fixedNums = parsed;
  }

  const table = getPrizeTable();
  const counts = {0:0,1:0,2:0,3:0,4:0,5:0};
  let totalWin = 0;
  const totalTickets = trials * perTrialTickets;

  // progress UI
  mcStopFlag = false;
  setMcUiRunning(true);
  document.querySelector("#mcBar").style.width = "0%";
  document.querySelector("#mcProg").textContent = "0%";

  // chunked loop to keep UI responsive
  const chunk = 250; // trials per chunk
  for(let t=0; t<trials; t+=chunk){
    if(mcStopFlag) break;
    const end = Math.min(trials, t+chunk);

    for(let i=t; i<end; i++){
      const win = drawWinning(rng);
      for(let k=0;k<perTrialTickets;k++){
        const ticket = (mode==="fixedSame") ? fixedNums : drawTicket(rng);
        const r = gradeTicket(ticket, win);
        counts[r.rank] = (counts[r.rank]||0) + 1;
        totalWin += prizeOf(r.rank, table);
      }
    }

    const doneTrials = end;
    const prog = doneTrials / trials;
    document.querySelector("#mcBar").style.width = (prog*100).toFixed(2) + "%";
    document.querySelector("#mcProg").textContent = (prog*100).toFixed(1) + "%";

    // allow paint
    await new Promise(requestAnimationFrame);
  }

  const evaluatedTickets = Object.values(counts).reduce((a,b)=>a+b,0);
  const cost = table.price * evaluatedTickets;
  const evPerTicket = evaluatedTickets>0 ? (totalWin / evaluatedTickets) : 0;
  const netPerTicket = evPerTicket - table.price;
  const roi = cost>0 ? (totalWin / cost - 1) : 0;

  document.querySelector("#mcTotalTickets").textContent = fmt(evaluatedTickets);
  document.querySelector("#mcEvPerTicket").textContent = fmt(evPerTicket);
  document.querySelector("#mcNetPerTicket").textContent = (netPerTicket>=0?"+":"") + fmt(netPerTicket);
  document.querySelector("#mcNetPerTicket").className = "v mono " + (netPerTicket>=0 ? "good":"bad");
  document.querySelector("#mcRoi").textContent = (roi*100).toFixed(2) + "%";
  document.querySelector("#mcRoi").className = "v mono " + (roi>=0 ? "good":"bad");

  const setProb = (idP, idN, rank) => {
    const n = counts[rank]||0;
    document.querySelector(idN).textContent = fmt(n);
    document.querySelector(idP).textContent = evaluatedTickets>0 ? pct(n / evaluatedTickets) : "0%";
  };
  setProb("#mp1","#mn1",1);
  setProb("#mp2","#mn2",2);
  setProb("#mp3","#mn3",3);
  setProb("#mp4","#mn4",4);
  setProb("#mp5","#mn5",5);
  setProb("#mp0","#mn0",0);

  // finalize progress
  const finalProg = (evaluatedTickets / totalTickets);
  document.querySelector("#mcBar").style.width = (finalProg*100).toFixed(2) + "%";
  document.querySelector("#mcProg").textContent = (finalProg*100).toFixed(1) + "%";

  setMcUiRunning(false);
});

/* init */
renderTickets();
setDrawNote();
updateSummary();
</script>
</body>
</html>
